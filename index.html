<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Modelling Kinship Dynamics through DemoKin</title>

<script src="index_files/header-attrs-2.20/header-attrs.js"></script>
<script src="index_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="index_files/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Modelling Kinship Dynamics through
<code>DemoKin</code></h1>
<h4 class="date">Updated: 2025-02-27</h4>

</div>


<div id="section" class="section level1 tabset">
<h1 class="tabset"></h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Kinship is a fundamental property of human populations and a key form
of social structure. Demographers have long been interested in the
interplay between demographic change and family configuration. This has
led to the development of sophisticated methodological and conceptual
approaches for the study of kinship, some of which are reviewed in this
course.</p>
<p>Please make sure to complete the following preparatory steps before
the training workshop:</p>
<ol style="list-style-type: decimal">
<li>If you haven’t already, install R and RStudio. This is a useful
tutorial: <a
href="https://rstudio-education.github.io/hopr/starting.html"
class="uri">https://rstudio-education.github.io/hopr/starting.html</a></li>
<li>Install the following packages in R:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyr&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;readr&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;knitr&quot;</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;data.table&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;Matrix&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># DemoKin is available on [CRAN](https://cran.r-project.org/web/packages/DemoKin/index.html), </span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"># but we&#39;ll use the development version on [GitHub](https://github.com/IvanWilli/DemoKin):</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;IvanWilli/DemoKin&quot;</span>)</span></code></pre></div>
<p>Now, check if the packages can be loaded:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">library</span>(DemoKin)</span></code></pre></div>
</div>
<div id="model-stratified-by-age" class="section level2 tabset">
<h2 class="tabset">Model Stratified by Age</h2>
<div id="simple-model-one-sex-time-invariant" class="section level3">
<h3>Simple model: One-sex time-invariant</h3>
<!-- Create custom TOC for this section -->
<div class="custom-toc">
<h4>
Contents
</h4>
<ul>
<li>
<a href="#load-packages">1. Load packages</a>
</li>
<li>
<a href="#demographic-data">2. Demographic data</a>
</li>
<li>
<a href="#the-demokin-package">3. The DemoKin package</a>
</li>
<li>
<a href="#kinship-diagrams">4. Kinship diagrams</a>
</li>
<li>
<a href="#number-of-living-kin">5. Number of living kin</a>
</li>
<li>
<a href="#age-distribution-of-living-kin">6. Age distribution of living
kin</a>
</li>
</ul>
</div>
<p>First, we compute kin counts in a <strong>time-invariant</strong>
framework. We assume that Focal and all of her relatives experience the
2015 mortality and fertility rates throughout their entire lives <span
class="citation">(Caswell 2019)</span>. The <code>DemoKin</code> package
includes data from Sweden as an example: age-by-year matrices of
survival probabilities (<em>swe_px</em>), survival ratios
(<em>swe_Sx</em>), fertility rates (<em>swe_asfr</em>), and population
numbers (<em>swe_pop</em>). You can see the data contained in
<code>DemoKin</code> with <code>data(package="DemoKin")</code>. This
data comes from the <a href="https://www.mortality.org/">Human Mortality
Database</a> and <a href="https://www.humanfertility.org/">Human
Fertility Database</a> (see <code>?DemoKin::get_HMDHFD</code>).</p>
<div id="load-packages" class="section level4">
<h4>1. Load packages</h4>
<p>Load packages that will be useful:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">library</span>(DemoKin)</span></code></pre></div>
<p>Load a couple of functions we prepared:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span></code></pre></div>
</div>
<div id="demographic-data" class="section level4">
<h4>2. Demographic data</h4>
<p>In order to implement the time-invariant models, the function
<code>DemoKin::kin</code> expects a vector of survival ratios and
another vector of fertility rates. In this example, we get the data for
the year 2015, and run the matrix models.</p>
<p>The first dataframe is <code>swe_px</code>, a long-format data frame
with year- and age-specific survival probabilities (‘px’) from a life
table and the second dataframe<code>swe_asfr</code> shows the
age-specific fertility rates (‘px’).</p>
<p>For women:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>swe_px[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##      1900    1901    1902    1903    1904    1905    1906    1907    1908    1909
## 0 0.91060 0.90673 0.92298 0.91890 0.92357 0.92094 0.92717 0.93134 0.92217 0.93524
## 1 0.97225 0.97293 0.97528 0.97549 0.97847 0.97844 0.98066 0.98175 0.97928 0.98415
## 2 0.98525 0.98579 0.98630 0.98835 0.98921 0.98914 0.99050 0.99149 0.99135 0.99200
## 3 0.98998 0.98947 0.99079 0.99125 0.99226 0.99112 0.99341 0.99351 0.99383 0.99429
## 4 0.99158 0.99133 0.99231 0.99352 0.99272 0.99300 0.99392 0.99539 0.99526 0.99560
## 5 0.99310 0.99253 0.99401 0.99388 0.99468 0.99394 0.99542 0.99587 0.99570 0.99624
## 6 0.99423 0.99361 0.99500 0.99518 0.99535 0.99441 0.99566 0.99662 0.99672 0.99712
## 7 0.99540 0.99488 0.99585 0.99542 0.99587 0.99559 0.99666 0.99660 0.99671 0.99723
## 8 0.99489 0.99475 0.99573 0.99605 0.99635 0.99513 0.99630 0.99665 0.99713 0.99772
## 9 0.99549 0.99529 0.99635 0.99670 0.99672 0.99572 0.99699 0.99696 0.99733 0.99739</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>swe_asfr[<span class="dv">20</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##       1900    1901    1902    1903    1904    1905    1906    1907    1908    1909
## 19 0.04409 0.04357 0.04742 0.04380 0.04523 0.04415 0.04779 0.04910 0.05205 0.05274
## 20 0.06776 0.07122 0.06989 0.06792 0.06952 0.06981 0.07187 0.07211 0.07994 0.07930
## 21 0.09643 0.09931 0.09613 0.09654 0.09546 0.09437 0.09761 0.10108 0.10547 0.10456
## 22 0.12512 0.12555 0.12526 0.11899 0.12269 0.11923 0.12264 0.12384 0.12738 0.12639
## 23 0.14631 0.14792 0.14743 0.14237 0.14304 0.14502 0.14433 0.14440 0.14694 0.14607
## 24 0.16285 0.16847 0.16455 0.16279 0.15931 0.15960 0.16276 0.16271 0.16524 0.16087
## 25 0.18104 0.18322 0.17980 0.17339 0.17595 0.17445 0.17302 0.17246 0.17631 0.17423
## 26 0.18762 0.19279 0.19170 0.18754 0.18431 0.18248 0.18763 0.18405 0.18594 0.18250
## 27 0.19838 0.20267 0.19365 0.19035 0.19298 0.19016 0.19172 0.18634 0.18591 0.18912
## 28 0.20742 0.20543 0.19983 0.19558 0.19680 0.19696 0.19541 0.19489 0.19251 0.19381
## 29 0.20192 0.21060 0.20264 0.19938 0.19541 0.19482 0.19236 0.19205 0.19452 0.18839</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># First, get vectors for a given year</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>swe_surv_2015 <span class="ot">&lt;-</span> swe_px[,<span class="st">&quot;2015&quot;</span>]</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>swe_asfr_2015 <span class="ot">&lt;-</span> swe_asfr[,<span class="st">&quot;2015&quot;</span>]</span></code></pre></div>
<p>Let’s see what data we will be using. The first dataframe is
<code>swe_px</code>, a wide-format data frame with year- and
age-specific survival probabilities (‘px’) from a life table, the second
dataframe<code>swe_asfr</code> shows the age-specific fertility rates
(‘px’) and the third dataframe <code>swe_pop</code> shows the
age-specific population counts.</p>
<p>For women, we print the value at the first several ages in year 1950
and 2000:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">head</span>(swe_px[,<span class="fu">c</span>(<span class="st">&quot;1950&quot;</span>,<span class="st">&quot;2000&quot;</span>)])</span></code></pre></div>
<pre><code>##      1950    2000
## 0 0.98237 0.99717
## 1 0.99833 0.99984
## 2 0.99885 0.99986
## 3 0.99904 0.99996
## 4 0.99938 0.99988
## 5 0.99920 0.99992</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">head</span>(swe_asfr[,<span class="fu">c</span>(<span class="st">&quot;1950&quot;</span>,<span class="st">&quot;2000&quot;</span>)])</span></code></pre></div>
<pre><code>##   1950 2000
## 0    0    0
## 1    0    0
## 2    0    0
## 3    0    0
## 4    0    0
## 5    0    0</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">head</span>(swe_pop[,<span class="fu">c</span>(<span class="st">&quot;1950&quot;</span>,<span class="st">&quot;2000&quot;</span>)])</span></code></pre></div>
<pre><code>##    1950  2000
## 0 57780 43058
## 1 60451 43599
## 2 61288 44356
## 3 62970 46880
## 4 63089 50383
## 5 62963 55150</code></pre>
<p>Let us visualise some of our demographic data. We start with the
probability of dying between ages <span class="math inline">\(x\)</span>
and <span class="math inline">\(x+1\)</span>,<span
class="math inline">\(q_x\)</span> in a life table for women:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>swe_px <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>))<span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="sc">-</span><span class="fu">c</span>(age), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;px&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">qx =</span> <span class="dv">1</span><span class="sc">-</span>px) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> qx, <span class="at">col =</span> <span class="fu">as.character</span>(year)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Probability of dying, qx&quot;</span>, <span class="at">col =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Next, we have age-specific fertility rates for multiple years:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>swe_asfr <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>))<span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="sc">-</span><span class="fu">c</span>(age), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;fx&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> fx, <span class="at">col =</span> <span class="fu">as.character</span>(year)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Age-specific fertility rate, fx&quot;</span>, <span class="at">col =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finally, we have the population counts:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>swe_pop <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>))<span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>age, <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;pop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">gsub</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>, year)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pop, <span class="at">col =</span> <span class="fu">as.character</span>(year)), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Population alive in thousands&quot;</span>, <span class="at">col =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="the-demokin-package" class="section level4">
<h4>3. The DemoKin package</h4>
<p><code>DemoKin</code> can be used to compute the number and age
distribution of Focal’s relatives under a range of assumptions,
including living and deceased kin. Let’s explore the main functions.</p>
<div id="the-function-kin" class="section level5">
<h5>3.1. The function <code>kin()</code></h5>
<p>The function <code>DemoKin::kin()</code> currently does most of the
heavy lifting in terms of implementing matrix kinship models.</p>
<p>For this example, we will run the simplest model, with the following
assumptions:</p>
<ol style="list-style-type: decimal">
<li>Rates are <strong>time-invariant</strong>; i.e., the same set of
rates apply at all times. For this example, these will be the 2020
rates.</li>
<li>The population has one <strong>one-sex</strong>; i.e., we only use
female data as input and trace descent through female lines.</li>
</ol>
<p>Now we can run the kinship models:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>swe_2015 <span class="ot">&lt;-</span> <span class="fu">kin</span>(<span class="at">p =</span> swe_surv_2015, <span class="at">f =</span> swe_asfr_2015, <span class="at">time_invariant =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="arguments-of-kin" class="section level5">
<h5>3.2. Arguments of <code>kin()</code></h5>
<ul>
<li><strong>p</strong> numeric. A vector (atomic) or matrix of survival
probabilities with rows as ages (and columns as years in case of
matrix).</li>
<li><strong>f</strong> numeric. Same as U but for fertility rates.</li>
<li><strong>time_invariant</strong> logical. Assume time-invariant
rates. Default TRUE.</li>
<li><strong>output_kin</strong> character. kin types to return: “m” for
mother, “d” for daughter, …</li>
</ul>
</div>
<div id="relative-types" class="section level5">
<h5>3.3 Relative types</h5>
<p>Relatives for the <code>output_kin</code> argument are identified by
a unique code. Note that the relationship codes used in
<code>DemoKin</code> differ from those in Caswell <span
class="citation">(2019)</span>. The equivalence between the two set of
codes is given in the following table:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>demokin_codes</span></code></pre></div>
<pre><code>##    DemoKin Caswell               Labels_female                   Labels_male
## 1      coa       t    Cousins from older aunts     Cousins from older uncles
## 2      cya       v  Cousins from younger aunts   Cousins from younger uncles
## 3        c    &lt;NA&gt;                     Cousins                       Cousins
## 4        d       a                   Daughters                          Sons
## 5       gd       b             Grand-daughters                    Grand-sons
## 6      ggd       c       Great-grand-daughters              Great-grand-sons
## 7      ggm       h          Great-grandmothers            Great-grandfathers
## 8       gm       g                Grandmothers                  Grandfathers
## 9        m       d                      Mother                        Father
## 10     nos       p   Nieces from older sisters   Nephews from older brothers
## 11     nys       q Nieces from younger sisters Nephews from younger brothers
## 12       n    &lt;NA&gt;                      Nieces                       Nephews
## 13      oa       r     Aunts older than mother     Uncles older than fathers
## 14      ya       s   Aunts younger than mother    Uncles younger than father
## 15       a    &lt;NA&gt;                       Aunts                        Uncles
## 16      os       m               Older sisters                Older brothers
## 17      ys       n             Younger sisters              Younger brothers
## 18       s    &lt;NA&gt;                     Sisters                      Brothers
##                          Labels_2sex
## 1    Cousins from older aunts/uncles
## 2  Cousins from younger aunts/uncles
## 3                            Cousins
## 4                           Children
## 5                    Grand-childrens
## 6              Great-grand-childrens
## 7                Great-grandfparents
## 8                       Grandparents
## 9                            Parents
## 10      Niblings from older siblings
## 11    Niblings from younger siblings
## 12                          Niblings
## 13   Aunts/Uncles older than parents
## 14 Aunts/Uncles younger than parents
## 15                      Aunts/Uncles
## 16                    Older siblings
## 17                  Younger siblings
## 18                          Siblings</code></pre>
</div>
<div id="value" class="section level5">
<h5>3.4. Value</h5>
<p><code>DemoKin::kin()</code> returns a list containing two data
frames: <code>kin_full</code> and <code>kin_summary</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">str</span>(swe_2015)</span></code></pre></div>
<pre><code>## List of 2
##  $ kin_full   : tibble [142,814 × 7] (S3: tbl_df/tbl/data.frame)
##   ..$ kin      : chr [1:142814] &quot;d&quot; &quot;d&quot; &quot;d&quot; &quot;d&quot; ...
##   ..$ age_kin  : int [1:142814] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ age_focal: int [1:142814] 0 1 2 3 4 5 6 7 8 9 ...
##   ..$ living   : num [1:142814] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ dead     : num [1:142814] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ cohort   : logi [1:142814] NA NA NA NA NA NA ...
##   ..$ year     : logi [1:142814] NA NA NA NA NA NA ...
##  $ kin_summary: tibble [1,414 × 10] (S3: tbl_df/tbl/data.frame)
##   ..$ age_focal     : int [1:1414] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ kin           : chr [1:1414] &quot;coa&quot; &quot;cya&quot; &quot;d&quot; &quot;gd&quot; ...
##   ..$ year          : logi [1:1414] NA NA NA NA NA NA ...
##   ..$ cohort        : logi [1:1414] NA NA NA NA NA NA ...
##   ..$ count_living  : num [1:1414] 0.2752 0.0898 0 0 0 ...
##   ..$ mean_age      : num [1:1414] 8.32 4.05 NaN NaN NaN ...
##   ..$ sd_age        : num [1:1414] 6.14 3.68 NaN NaN NaN ...
##   ..$ count_dead    : num [1:1414] 0.0000633 0.000037 0 0 0 ...
##   ..$ count_cum_dead: num [1:1414] 0.0000633 0.000037 0 0 0 ...
##   ..$ mean_age_lost : num [1:1414] 0 0 NaN NaN NaN 0 0 0 0 NaN ...</code></pre>
<div id="kin_full" class="section level6">
<h6><code>kin_full</code></h6>
<p>This data frame contains expected kin counts by year (or cohort), age
of Focal, type of kin and, age of kin, including living and dead kin at
that age.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">head</span>(swe_2015<span class="sc">$</span>kin_full)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   kin   age_kin age_focal living  dead cohort year 
##   &lt;chr&gt;   &lt;int&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;  &lt;lgl&gt;
## 1 d           0         0      0     0 NA     NA   
## 2 d           0         1      0     0 NA     NA   
## 3 d           0         2      0     0 NA     NA   
## 4 d           0         3      0     0 NA     NA   
## 5 d           0         4      0     0 NA     NA   
## 6 d           0         5      0     0 NA     NA</code></pre>
</div>
<div id="kin_summary" class="section level6">
<h6><code>kin_summary</code></h6>
<p>This is a ‘summary’ data frame derived from <code>kin_full</code>. To
produce it, we sum over all ages of kin to produce a data frame of
expected kin counts by year or cohort and age of Focal (but <em>not</em>
by age of kin).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">head</span>(swe_2015<span class="sc">$</span>kin_summary)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 10
##   age_focal kin   year  cohort count_living mean_age sd_age count_dead count_cum_dead
##       &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; &lt;lgl&gt;         &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
## 1         0 coa   NA    NA           0.275      8.32   6.14  0.0000633      0.0000633
## 2         0 cya   NA    NA           0.0898     4.05   3.68  0.0000370      0.0000370
## 3         0 d     NA    NA           0        NaN    NaN     0              0        
## 4         0 gd    NA    NA           0        NaN    NaN     0              0        
## 5         0 ggd   NA    NA           0        NaN    NaN     0              0        
## 6         0 ggm   NA    NA           0.320     84.4    6.43  0.0287         0.0287   
## # ℹ 1 more variable: mean_age_lost &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="kinship-diagrams" class="section level4">
<h4>4. Kinship diagrams</h4>
<p>We can visualize the kinship structure we just computed using a
network or ‘Keyfitz’ kinship diagram <span class="citation">(Keyfitz,
Caswell, et al. 2005)</span> with the <code>plot_diagram</code>
function. Let’s see the expected number of living kin for a 65 yo woman
in Singapore according to our model:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>swe_2015<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="fu">filter</span>(age_focal <span class="sc">==</span> <span class="dv">65</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="fu">select</span>(kin, <span class="at">count =</span> count_living) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  <span class="fu">plot_diagram</span>(<span class="at">rounding =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/10-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="number-of-living-kin" class="section level4">
<h4>5. Number of living kin</h4>
<p>Let’s run the model again with the same parameters, selecting
specific kin types (note the <code>output_kin</code> argument:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>swe_2015 <span class="ot">&lt;-</span> </span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="fu">kin</span>(</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    <span class="at">p =</span> swe_surv_2015</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    , <span class="at">f =</span> swe_asfr_2015</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>    , <span class="at">output_kin =</span> <span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>, <span class="st">&quot;ggd&quot;</span>, <span class="st">&quot;gm&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;s&quot;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>    , <span class="at">time_invariant =</span> <span class="cn">TRUE</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    )</span></code></pre></div>
<p>Now, let’s visualize how the expected number of daughters, siblings,
cousins, etc., changes over the life course of Focal (now, with full
names to identify each relative type using the function
<code>DemoKin::rename_kin()</code>).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>swe_2015<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  <span class="fu">rename_kin</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(age_focal, count_living))  <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age of focal&quot;</span>, <span class="at">y=</span> <span class="st">&quot;Number of living female relatives&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin_label)</span></code></pre></div>
<p><img src="index_files/figure-html/28-1.png" width="768" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Note that we are working in a time invariant framework. You can think
of the results as analogous to life expectancy (i.e., expected years of
life for a synthetic cohort experiencing a given set of period mortality
rates).</p>
</blockquote>
<p>How does overall family size (and family composition) vary over life
for an average woman who survives to each age?</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>counts <span class="ot">&lt;-</span> </span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  swe_2015<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="fu">group_by</span>(age_focal) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_living =</span> <span class="fu">sum</span>(count_living)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>swe_2015<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>  <span class="fu">select</span>(age_focal, kin, count_living) <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  <span class="fu">rename_kin</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count_living)) <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill =</span> kin_label), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> counts, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age of focal&quot;</span>,</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of living female relatives&quot;</span>,</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Kin&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/29-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="age-distribution-of-living-kin" class="section level4">
<h4>6. Age distribution of living kin</h4>
<p>How old are Focal’s relatives? Using the <code>kin_full</code> data
frame, we can visualize the age distribution of Focal’s relatives
throughout Focal’s life. For example when Focal is 65 (the red vertical
line in the plot), what are the ages of her relatives:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>swe_2015<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="fu">rename_kin</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="fu">filter</span>(age_focal <span class="sc">==</span> <span class="dv">65</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_kin, living)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">65</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age of kin&quot;</span>,</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Expected number of living relatives&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin_label)</span></code></pre></div>
<p><img src="index_files/figure-html/30-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="adding-time-one-sex-time-varying" class="section level3">
<h3>Adding time: One-sex time-varying</h3>
<div class="custom-toc">
<h4>
Contents
</h4>
<ul>
<li>
<a href="#run-the-model-time-varying">1. Run the model</a>
</li>
<li>
<a href="#living-relatives">2. Living Relatives</a>
</li>
<li>
<a href="#kin-loss">3. Kin Loss</a>
</li>
<li>
<a href="#prevelances">4. Prevelances</a>
</li>
</ul>
</div>
<p>The demography of Sweden is, in reality, changing every year. This
means that Focal and her relatives will have experienced changing
mortality and fertility rates over time. We account for this, by using
the <strong>one-sex time-varying</strong> models introduced by Caswell
and Song <span class="citation">(2021)</span>.</p>
<div id="run-the-model-time-varying" class="section level4">
<h4>1. Run the model</h4>
<p>Let’s take a look at the resulting kin counts for a Focal born in
1960, limiting the output to the relative types given in the argument
<code>output_kin</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>swe_time_varying <span class="ot">&lt;-</span> </span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="fu">kin</span>(</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    <span class="at">p =</span> swe_px,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    <span class="at">f =</span> swe_asfr,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    <span class="at">n =</span> swe_pop,</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>    <span class="at">time_invariant =</span><span class="cn">FALSE</span>,</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    <span class="at">output_cohort =</span> <span class="dv">1960</span>,</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    <span class="at">output_kin =</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>,<span class="st">&quot;gd&quot;</span>,<span class="st">&quot;ggd&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;gm&quot;</span>,<span class="st">&quot;ggm&quot;</span>)</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="living-relatives" class="section level4">
<h4>2. Living Realtives</h4>
<p>Let’s take a look at the number of living kin again.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>swe_time_varying<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_focal,count_living,<span class="at">color=</span><span class="fu">factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>,<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">3</span>,.<span class="dv">2</span>),<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">3</span>,.<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">35</span>, <span class="at">color=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of living relatives&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="kin-loss" class="section level4">
<h4>3. Kin Loss</h4>
<p>Kin loss can have severe consequences for bereaved relatives. It can
also affect the provision of care support and intergenerational
transfers over the life course. The function <code>kin</code> also
includes information on the number of relatives lost by Focal during her
life, stored in the column <code>count_cum_death</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>swe_time_varying<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(age_focal, count_cum_dead)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of deceased relatives&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Given these population-level measures, we can compute Focal’s the
mean age at the time of her relative’s death. For a Focal aged 50
yo:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>swe_time_varying<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="fu">filter</span>(age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="fu">select</span>(kin,count_cum_dead,mean_age_lost) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">kin</th>
<th align="right">count_cum_dead</th>
<th align="right">mean_age_lost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">d</td>
<td align="right">0.01</td>
<td align="right">32.59</td>
</tr>
<tr class="even">
<td align="left">gd</td>
<td align="right">0.00</td>
<td align="right">47.13</td>
</tr>
<tr class="odd">
<td align="left">ggd</td>
<td align="right">0.00</td>
<td align="right">49.66</td>
</tr>
<tr class="even">
<td align="left">ggm</td>
<td align="right">0.22</td>
<td align="right">8.94</td>
</tr>
<tr class="odd">
<td align="left">gm</td>
<td align="right">0.84</td>
<td align="right">24.96</td>
</tr>
<tr class="even">
<td align="left">m</td>
<td align="right">0.32</td>
<td align="right">37.83</td>
</tr>
</tbody>
</table>
</div>
<div id="prevelances" class="section level4">
<h4>4. Prevalences</h4>
<p>Given the distribution of kin by age, we can compute the expected
portion of living kin in some stage given a set of prevalences by age
(e.g., a disease, employment, etc.). This is known as the Sullivan
Method in the life-table literature. A matrix formulation for same
results can be found in Caswell <span class="citation">(2019)</span>,
which can also be extended to a time-variant framework.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co"># let´s create some prevalence by age</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>swe_2015_prevalence <span class="ot">&lt;-</span> </span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>    <span class="at">age_kin =</span> <span class="fu">unique</span>(swe_2015<span class="sc">$</span>kin_full<span class="sc">$</span>age_kin),</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>    <span class="at">prev =</span> .<span class="dv">005</span> <span class="sc">*</span> <span class="fu">exp</span>(.<span class="dv">05</span> <span class="sc">*</span> age_kin)</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>    )</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a><span class="co"># join to kin count estimates and plot</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>swe_2015<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  <span class="fu">left_join</span>(swe_2015_prevalence) <span class="sc">%&gt;%</span> </span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>  <span class="fu">group_by</span>(kin, age_focal) <span class="sc">%&gt;%</span> </span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>    <span class="at">prevalent =</span> <span class="fu">sum</span>(living <span class="sc">*</span> prev),</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>    <span class="at">no_prevalent =</span> <span class="fu">sum</span>(living <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>prev))</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> prevalent<span class="sc">:</span>no_prevalent, <span class="at">names_to =</span> <span class="st">&quot;prevalence_state&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age_focal, <span class="at">y =</span> count)) <span class="sc">+</span> </span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill=</span>prevalence_state)) <span class="sc">+</span></span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin) <span class="sc">+</span></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="adding-sex-two-sex-time-invariant" class="section level3">
<h3>Adding sex: Two-sex time-invariant</h3>
<div class="custom-toc">
<h4>
Contents
</h4>
<ul>
<li>
<a href="#model-input-2sex">1. Model Input</a>
</li>
<li>
<a href="#run-model-2sex">2. Run the model</a>
</li>
</ul>
</div>
<p>Human males generally live shorter and reproduce later than females.
These sex-specific processes affect kinship dynamics in a number of
ways. For example, the degree to which an average member of the
population, call her Focal, has a living grandparent is affected by
differential mortality affecting the parental generation at older ages.
We may also be interested in considering how kinship structures vary by
Focal’s sex: a male Focal may have a different number of grandchildren
than a female Focal given differences in fertility by sex. Documenting
these differences matters since women often face greater expectations to
provide support and informal care to relatives. As they live longer,
they may find themselves at greater risk of being having no living kin.
The function <code>kin2sex</code> implements two-sex kinship models as
introduced by Caswell <span class="citation">(2022)</span>. This
vignette show how to run two-sex models and highlights some of the
advantages of this model over one-sex models in populations with
time-invariant and time-variant rates.</p>
<div id="model-input-2sex" class="section level4">
<h4>1. Model input</h4>
<p>Data on female fertility by age is less common than female fertility.
Schoumaker (2019) shows that male TFR is almost always higher than
female Total Fertility Rates (TFR) using a sample of 160 countries. For
this example, we use data from 2012 France to exemplify the use of the
two-sex function. Data on female and male fertility and mortality are
included in <code>DemoKin</code>. In this population, male and female
TFR is almost identical (1.98 and 1.99) but the distributions of
fertility by sex varies over age:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>fra_fert_f <span class="ot">&lt;-</span> fra_asfr_sex[,<span class="st">&quot;ff&quot;</span>]</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>fra_fert_m <span class="ot">&lt;-</span> fra_asfr_sex[,<span class="st">&quot;fm&quot;</span>]</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>fra_surv_f <span class="ot">&lt;-</span> fra_surv_sex[,<span class="st">&quot;pf&quot;</span>]</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>fra_surv_m <span class="ot">&lt;-</span> fra_surv_sex[,<span class="st">&quot;pm&quot;</span>]</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="fu">sum</span>(fra_fert_m)<span class="sc">-</span><span class="fu">sum</span>(fra_fert_f)</span></code></pre></div>
<pre><code>## [1] -0.0115</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">value =</span> <span class="fu">c</span>(fra_fert_f, fra_fert_m, fra_surv_f, fra_surv_m),</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>           <span class="at">age =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">4</span>),</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>           <span class="at">sex =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;f&quot;</span>, <span class="dv">101</span>), <span class="fu">rep</span>(<span class="st">&quot;m&quot;</span>, <span class="dv">101</span>)), <span class="dv">2</span>),</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>           <span class="at">risk =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;fertility rate&quot;</span>, <span class="dv">101</span> <span class="sc">*</span> <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">&quot;survival probability&quot;</span>, <span class="dv">101</span> <span class="sc">*</span> <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">col=</span>sex)) <span class="sc">+</span> </span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> risk, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span> </span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="run-model-2sex" class="section level4">
<h4>2. Run the model</h4>
<p>We now introduce the functions <code>kin2sex</code>, which is similar
to the one-sex function <code>kin</code> (see <code>?kin</code>) with
two exceptions. First, the user needs to specify mortality and fertility
by sex. Second, the user must indicate the sex of Focal (which was
assumed to be female in the one-sex model). Let us first consider the
application for time-invariant populations:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>kin_result <span class="ot">&lt;-</span> <span class="fu">kin2sex</span>(</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>  <span class="at">pf =</span> fra_surv_f,</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="at">pm =</span> fra_surv_m, </span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>  <span class="at">ff =</span> fra_fert_f, </span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>  <span class="at">fm =</span> fra_fert_m, </span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>  <span class="at">time_invariant =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>  <span class="at">sex_focal =</span> <span class="st">&quot;f&quot;</span>, </span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>  <span class="at">birth_female =</span> .<span class="dv">5</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>  )</span></code></pre></div>
<p>The output of <code>kin2sex</code> is equivalent to that of
<code>kin</code>, except that it includes a column <code>sex_kin</code>
to specify the sex of the given relatives.</p>
<p>Let’s group aunts and siblings to visualize the number of living kin
by Focal’s age.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>kin_out <span class="ot">&lt;-</span> kin_result<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kin =</span> <span class="fu">case_when</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;s&quot;</span>, <span class="st">&quot;s&quot;</span>) <span class="sc">~</span> <span class="st">&quot;s&quot;</span>,</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>                         kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ya&quot;</span>, <span class="st">&quot;oa&quot;</span>) <span class="sc">~</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>                         T <span class="sc">~</span> kin)) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>  <span class="fu">filter</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>, <span class="st">&quot;ggm&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;a&quot;</span>))</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a>kin_out <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>  <span class="fu">group_by</span>(kin, age_focal, sex_kin) <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count_living)) <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_focal, count, <span class="at">fill=</span>sex_kin))<span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>  <span class="fu">geom_area</span>()<span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>A note on terminology</strong></p>
<p>The function <code>kin2sex</code> uses the same codes as
<code>kin</code> to identify relatives (see
<code>demokin_codes()</code>). Note that when running a two-sex model,
the code ‘m’ refers to either mothers or fathers! Use the column
<code>sex_kin</code> to determine the sex of a given relatives. For
example, in order to consider only sons and ignore daughters, use:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>kin_result<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="fu">filter</span>(kin <span class="sc">==</span> <span class="st">&quot;d&quot;</span>, sex_kin <span class="sc">==</span> <span class="st">&quot;m&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 11
##   age_focal kin   sex_kin year  cohort count_living mean_age sd_age count_dead
##       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;lgl&gt; &lt;lgl&gt;         &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1         0 d     m       NA    NA                0      NaN    NaN          0
## 2         1 d     m       NA    NA                0      NaN    NaN          0
## 3         2 d     m       NA    NA                0      NaN    NaN          0
## 4         3 d     m       NA    NA                0      NaN    NaN          0
## 5         4 d     m       NA    NA                0      NaN    NaN          0
## 6         5 d     m       NA    NA                0      NaN    NaN          0
## # ℹ 2 more variables: count_cum_dead &lt;dbl&gt;, mean_age_lost &lt;dbl&gt;</code></pre>
<p>Information on kin availability by sex allows us to consider sex
ratios, a traditional measure in demography, with females often in
denominator. The following figure, for example, shows that a 25yo French
woman in our hypothetical population can expect to have 0.5 grandfathers
for every grandmother:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>kin_out <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  <span class="fu">group_by</span>(kin, age_focal) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sex_ratio=</span><span class="fu">sum</span>(count_living[sex_kin<span class="sc">==</span><span class="st">&quot;m&quot;</span>], <span class="at">na.rm=</span>T)<span class="sc">/</span><span class="fu">sum</span>(count_living[sex_kin<span class="sc">==</span><span class="st">&quot;f&quot;</span>], <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_focal, sex_ratio))<span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The experience of kin loss for Focal depends on differences in
mortality between sexes. A female Focal starts losing fathers earlier
than mothers. We see a slightly different pattern for grandparents since
Focal’s experience of grandparental loss is dependent on the initial
availability of grandparents (i.e. if Focal’s grandparent died before
her birth, she will never experience his death).</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co"># sex ratio</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>kin_out <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>  <span class="fu">group_by</span>(kin, sex_kin, age_focal) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count_dead)) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_focal, count, <span class="at">col=</span>sex_kin))<span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="adding-sex-and-time-two-sex-time-varying-approximation"
class="section level3">
<h3>Adding sex and time: Two-sex time-varying + approximation</h3>
<div class="custom-toc">
<h4>
Contents
</h4>
<ul>
<li>
<a href="#model-input-2sex-time-varying">1. Model input</a>
</li>
<li>
<a href="#run-mode-2sex-time-varying">2. Run the model</a>
</li>
<li>
<a href="#kin-availability-2sex-time-varying">3. Kin Availability</a>
</li>
<li>
<a href="#approximations">4. Approximations</a>
</li>
<li>
<a href="#prevelance-2sex-time-varying">5. Prevelance again: Causes of
death</a>
</li>
</ul>
</div>
<p>We look at populations where demographic rates are not static but
change on a yearly basis.</p>
<div id="model-input-2sex-time-varying" class="section level4">
<h4>1. Model input</h4>
<p>For this, we consider the case of Sweden using data pre-loaded in
<code>DemoKin</code>. For this example, we will create ‘pretend’ male
fertility rates by slightly perturbing the existing female rates. This
is a toy example, since a real two-sex model should use actual female
and male rates as inputs.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">ncol</span>(swe_px)</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">nrow</span>(swe_px)</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>swe_surv_f_matrix <span class="ot">&lt;-</span> swe_px</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>swe_surv_m_matrix <span class="ot">&lt;-</span> swe_px <span class="sc">^</span> <span class="fl">1.5</span> <span class="co"># artificial perturbation for this example</span></span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>swe_fert_f_matrix <span class="ot">&lt;-</span> swe_asfr</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>swe_fert_m_matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">5</span>, years),  </span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a>            swe_asfr[<span class="sc">-</span>((ages<span class="dv">-4</span>)<span class="sc">:</span>ages),]) <span class="sc">*</span> <span class="fl">1.05</span> <span class="co"># artificial perturbation for this example</span></span></code></pre></div>
<p>This is how it looks for year 1900:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sex =</span> <span class="st">&quot;Female&quot;</span>, <span class="at">component =</span> <span class="st">&quot;Fertility rate&quot;</span>, <span class="at">value =</span> swe_fert_f_matrix[,<span class="st">&quot;1900&quot;</span>]),</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sex =</span> <span class="st">&quot;Male&quot;</span>, <span class="at">component =</span> <span class="st">&quot;Fertility rate&quot;</span>, <span class="at">value =</span> swe_fert_m_matrix[,<span class="st">&quot;1900&quot;</span>]),</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sex =</span> <span class="st">&quot;Female&quot;</span>, <span class="at">component =</span> <span class="st">&quot;Survival probability&quot;</span>, <span class="at">value =</span> swe_surv_f_matrix[,<span class="st">&quot;1900&quot;</span>]),</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sex =</span> <span class="st">&quot;Male&quot;</span>, <span class="at">component =</span> <span class="st">&quot;Survival probability&quot;</span>, <span class="at">value =</span> swe_surv_m_matrix[,<span class="st">&quot;1900&quot;</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>component, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="run-model-2sex-time-varying" class="section level4">
<h4>2. Run the model</h4>
<p>We now run the time-variant two-sex models (note the
<code>time_invariant = FALSE</code> argument):</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>kin_out_time_variant <span class="ot">&lt;-</span> <span class="fu">kin2sex</span>(</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>                      <span class="at">pf =</span> swe_surv_f_matrix, </span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a>                      <span class="at">pm =</span> swe_surv_m_matrix,</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>                      <span class="at">ff =</span> swe_fert_f_matrix, </span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a>                      <span class="at">fm =</span> swe_fert_m_matrix,</span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>                      <span class="at">sex_focal =</span> <span class="st">&quot;f&quot;</span>,</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>                      <span class="at">time_invariant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>                      <span class="at">birth_female =</span> .<span class="dv">5</span>,</span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a>                      <span class="at">output_cohort =</span> <span class="dv">1900</span></span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>                      )</span></code></pre></div>
</div>
<div id="kin-availability-2sex-time-varying" class="section level4">
<h4>3. Kin Availability</h4>
<p>We can plot data on kin availability alongside values coming from a
time-invariant model to show how demographic change matters: the
time-variant models take into account changes derived from the
demographic transition, whereas the time-invariant models assume
never-changing rates.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>kin_out_time_invariant <span class="ot">&lt;-</span> <span class="fu">kin2sex</span>(</span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>                      swe_surv_f_matrix[,<span class="st">&quot;1900&quot;</span>], swe_surv_m_matrix[,<span class="st">&quot;1900&quot;</span>], </span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a>                      swe_fert_f_matrix[,<span class="st">&quot;1900&quot;</span>], swe_fert_m_matrix[,<span class="st">&quot;1900&quot;</span>], </span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a>                      <span class="at">sex_focal =</span> <span class="st">&quot;f&quot;</span>, <span class="at">birth_female =</span> .<span class="dv">5</span>)</span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>kin_out_time_variant<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a>  <span class="fu">filter</span>(cohort <span class="sc">==</span> <span class="dv">1900</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;variant&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a>  <span class="fu">bind_rows</span>(kin_out_time_invariant<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;invariant&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kin =</span> <span class="fu">case_when</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ys&quot;</span>, <span class="st">&quot;os&quot;</span>) <span class="sc">~</span> <span class="st">&quot;s&quot;</span>,</span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a>                         kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ya&quot;</span>, <span class="st">&quot;oa&quot;</span>) <span class="sc">~</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a>                         T <span class="sc">~</span> kin)) <span class="sc">%&gt;%</span></span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a>  <span class="fu">filter</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>, <span class="st">&quot;ggm&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;a&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a>  <span class="fu">group_by</span>(type, kin, age_focal, sex_kin) <span class="sc">%&gt;%</span></span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count_living)) <span class="sc">%&gt;%</span></span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_focal, count, <span class="at">linetype=</span>type))<span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(kin), <span class="at">rows=</span><span class="fu">vars</span>(sex_kin), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="approximations" class="section level4">
<h4>4. Approximations</h4>
<p>Caswell <span class="citation">(2022)</span> introduced two
approaches for approximating two-sex kinship structures for cases when
male demographic rates are not available. The first is the
<em>androgynous</em> approximation, which assumes equal fertility and
survival for males and females. The second is the use of <em>GKP
factors</em> apply to each type of relative (e.g., multiplying mothers
by two to obtain the number of mothers and fathers).</p>
<p>Here, we present a visual evaluation of the accuracy of these
approximations by comparing to ‘true’ two-sex models using the French
data included with <code>DemoKin</code> for time-invariant models <span
class="citation">(Caswell 2022)</span>. We start by considering the
androgynous approximation. We compare expected kin counts by age and
find high levels of consistency for all kin types, except for
grandfathers and great-grandfathers:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>kin_out <span class="ot">&lt;-</span> <span class="fu">kin2sex</span>(fra_surv_f, fra_surv_m, fra_fert_f, fra_fert_m, <span class="at">sex_focal =</span> <span class="st">&quot;f&quot;</span>, <span class="at">birth_female =</span> .<span class="dv">5</span>)</span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>kin_out_androgynous <span class="ot">&lt;-</span> <span class="fu">kin2sex</span>(fra_surv_f, fra_surv_f, fra_fert_f, fra_fert_f, <span class="at">sex_focal =</span> <span class="st">&quot;f&quot;</span>, <span class="at">birth_female =</span> .<span class="dv">5</span>)</span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a>  kin_out<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;full&quot;</span>),</span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a>  kin_out_androgynous<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;androgynous&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a>  <span class="fu">group_by</span>(kin, age_focal, sex_kin, type) <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count_living)) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_focal, count, <span class="at">linetype =</span> type)) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">row =</span> <span class="fu">vars</span>(sex_kin), <span class="at">col =</span> <span class="fu">vars</span>(kin), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Next, we consider the use of GKP factors and find that it also
approximates relatively accurately kin counts at different ages of
Focal. These are presented as examples only. Users are invited to
perform more rigorous comparisons of these approximations.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># with gkp</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>kin_out_1sex <span class="ot">&lt;-</span> <span class="fu">kin</span>(fra_surv_f, fra_fert_f, <span class="at">birth_female =</span> .<span class="dv">5</span>)</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>kin_out_GKP <span class="ot">&lt;-</span> kin_out_1sex<span class="sc">$</span>kin_summary<span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count_living =</span> <span class="fu">case_when</span>(kin <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;gm&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;ggm&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">8</span>,</span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;d&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;gd&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;ggd&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;oa&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;ya&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;os&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;ys&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb52-15"><a href="#cb52-15" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;coa&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">8</span>,</span>
<span id="cb52-16"><a href="#cb52-16" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;cya&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">8</span>,</span>
<span id="cb52-17"><a href="#cb52-17" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;nos&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb52-18"><a href="#cb52-18" tabindex="-1"></a>                            kin <span class="sc">==</span> <span class="st">&quot;nys&quot;</span> <span class="sc">~</span> count_living <span class="sc">*</span> <span class="dv">4</span>))</span>
<span id="cb52-19"><a href="#cb52-19" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb52-21"><a href="#cb52-21" tabindex="-1"></a>  kin_out<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;full&quot;</span>),</span>
<span id="cb52-22"><a href="#cb52-22" tabindex="-1"></a>  kin_out_androgynous<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;androgynous&quot;</span>),</span>
<span id="cb52-23"><a href="#cb52-23" tabindex="-1"></a>  kin_out_GKP <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;gkp&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-24"><a href="#cb52-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kin =</span> <span class="fu">case_when</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ys&quot;</span>, <span class="st">&quot;os&quot;</span>) <span class="sc">~</span> <span class="st">&quot;s&quot;</span>,</span>
<span id="cb52-25"><a href="#cb52-25" tabindex="-1"></a>                          kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ya&quot;</span>, <span class="st">&quot;oa&quot;</span>) <span class="sc">~</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb52-26"><a href="#cb52-26" tabindex="-1"></a>                          kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;coa&quot;</span>, <span class="st">&quot;cya&quot;</span>) <span class="sc">~</span> <span class="st">&quot;c&quot;</span>,</span>
<span id="cb52-27"><a href="#cb52-27" tabindex="-1"></a>                          kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;nys&quot;</span>, <span class="st">&quot;nos&quot;</span>) <span class="sc">~</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb52-28"><a href="#cb52-28" tabindex="-1"></a>                          T <span class="sc">~</span> kin)) <span class="sc">%&gt;%</span></span>
<span id="cb52-29"><a href="#cb52-29" tabindex="-1"></a>  <span class="fu">filter</span>(age_focal <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">80</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-30"><a href="#cb52-30" tabindex="-1"></a>  <span class="fu">group_by</span>(kin, age_focal, type) <span class="sc">%&gt;%</span></span>
<span id="cb52-31"><a href="#cb52-31" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count_living)) <span class="sc">%&gt;%</span></span>
<span id="cb52-32"><a href="#cb52-32" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(type, count)) <span class="sc">+</span></span>
<span id="cb52-33"><a href="#cb52-33" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>type), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-34"><a href="#cb52-34" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>), <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-35"><a href="#cb52-35" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">col =</span> <span class="fu">vars</span>(kin), <span class="at">row =</span> <span class="fu">vars</span>(age_focal), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="prevalance-2sex-time-varying" class="section level4">
<h4>5. Prevelance again: Causes of death</h4>
<p>Now assume we have two causes of death (COD). For females, the risk
of the first COD is half the risk of the second COD for ages greater
than 50. For males, the risk of the first COD is 2/3 of the second COD
for ages greater than 50. We operationalize this using two matrices with
dimension 2 by 101 (number of causes by number of ages).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>Hf <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>( .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="fu">length</span>(fra_surv_f))</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>Hm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">33</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="fu">length</span>(fra_surv_f))</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>Hf[,<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>] <span class="ot">&lt;-</span> Hm[,<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>This is a generalization of the approach outlined by Caswell <span
class="citation">(2023)</span>. In the original formulation, the inputs
in matrix <span class="math inline">\(H\)</span> are the hazard rates.
Here, we treat them like a relative risk factor related to the
underlying probability of dying. For more details, see section 2.3 and
formula 30 in section A.1 of Caswell <span
class="citation">(2023)</span>. Now we run the time-invariant two-sex
model by COD for France 2012, assuming a death count distribution based
on the two competing causes; note that the <code>kin2sex</code> function
now takes the arguments <code>Hf</code> and <code>Hm</code> but the
other arguments remain unchanged:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>kin_out_cod_invariant <span class="ot">&lt;-</span> <span class="fu">kin2sex</span>(</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>                      <span class="at">pf =</span> fra_surv_f,</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>                      <span class="at">pm =</span> fra_surv_m, </span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>                      <span class="at">ff =</span> fra_fert_f, </span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>                      <span class="at">fm =</span> fra_fert_m,</span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>                      <span class="at">Hf =</span> Hf,</span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a>                      <span class="at">Hm =</span> Hm,</span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a>                      <span class="at">time_invariant =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The output of <code>kin2sex</code> is the the <code>kin_full</code>
data frame that we have encountered before. The only differences is that
<code>kin_full</code> now includes one column for each COD specified in
the input. Therefore, the number of columns will vary depending on how
many COD you are considering!</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">head</span>(kin_out_cod_invariant)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   year  cohort age_focal sex_kin kin   age_kin living deadcause1 deadcause2
##   &lt;lgl&gt; &lt;lgl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 NA    NA             0 f       d           0      0          0          0
## 2 NA    NA             1 f       d           0      0          0          0
## 3 NA    NA             2 f       d           0      0          0          0
## 4 NA    NA             3 f       d           0      0          0          0
## 5 NA    NA             4 f       d           0      0          0          0
## 6 NA    NA             5 f       d           0      0          0          0</code></pre>
<p>We can now plot the death distribution by age and COD of Focal’s
parents when Focal is 30 yo.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>kin_out_cod_invariant <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>  <span class="fu">filter</span>(kin <span class="sc">==</span> <span class="st">&quot;m&quot;</span>, age_focal <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">deadcause1 =</span> <span class="fu">sum</span>(deadcause1),</span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>            <span class="at">deadcause2 =</span> <span class="fu">sum</span>(deadcause2), <span class="at">.by =</span> <span class="fu">c</span>(age_kin, sex_kin)) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(deadcause1<span class="sc">:</span>deadcause2) <span class="sc">%&gt;%</span> </span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age_kin, value, <span class="at">col =</span> sex_kin, <span class="at">linetype =</span> name)) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of parental deaths&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In this simplified example, the parents of Focal only died after age
50. This helped highlight the relative difference between the COD for
each sex. Note that the sum of the death counts by sex gives the same
result as the total deaths by sex at that age in the less complex model
(i.e., the one that does not consider COD, see section 2 of this
guide).</p>
<p>You can add as many COD as you want, but keep in mind that this can
be computationally intensive. For time-variant kinship models that
consider COD, you must provide a list of matrices by sex (<span
class="math inline">\(Hf\)</span> and <span
class="math inline">\(Hm\)</span>). The elements of this list should be
<span class="math inline">\(H\)</span> matrices for each year (following
the same order than the mortality and fertility components).</p>
</div>
</div>
</div>
<div id="model-stratified-by-both-age-and-stage"
class="section level2 tabset">
<h2 class="tabset">Model Stratified by both Age and Stage</h2>
<div id="simple-model-one-sex-time-invariant-multi-state-models"
class="section level3">
<h3>Simple model: One-sex Time-invariant Multi-state models</h3>
<div class="custom-toc">
<h4>
Contents
</h4>
<ul>
<li>
<a href="#run-model-multi-state">1. Run the model</a>
</li>
<li>
<a href="#age-and-parity-distribution">2. Age and parity distribution of
kin</a>
</li>
<li>
<a href="#kin-by-parity">3. Kin counts by parity</a>
</li>
</ul>
</div>
<p><code>DemoKin</code> allows the computation of kin structures in a
multi-state framework, classifying individuals jointly by age and some
other feature (e.g., stages of a disease). For this, we need mortality
and fertility data for each possible stage and probabilities of changing
state by age.</p>
<p>Let’s consider the example of Slovakia given by Caswell <span
class="citation">(2021)</span>, where stages are parity states.
<code>DemoKin</code> includes the data to replicate this analysis for
the year 1980:</p>
<ul>
<li>The data.frame <code>svk_fxs</code> is the fertility rate by age
(rows) for each parity stage (columns). The first stage represents <span
class="math inline">\(parity=0\)</span>; the second stage, <span
class="math inline">\(parity=1\)</span>; and so on, until finally the
sixth stage represents <span
class="math inline">\(parity\geq5\)</span>.</li>
<li>The data.frame <code>svk_Hxs</code> has a similar structure but with
<span class="math inline">\(1\)</span>’s in the ages corresponding to
newborns (the first age in our example).</li>
<li>The data.frame <code>svk_pxs</code> has the same structure and
represents survival probabilities.</li>
<li>The list <code>svk_Uxs</code> has the same number of elements and
ages (in this case 110, where <span class="math inline">\(omega\)</span>
is 109). For each age, it contains a column-stochastic transition matrix
with dimension for the state space. The entries are transition
probabilities conditional on survival.</li>
</ul>
<div id="run-model-multi-state" class="section level4">
<h4>1. Run the model</h4>
<p>Following Caswell <span class="citation">(2020)</span>, we can obtain
the joint age-parity kin structure:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="co"># use birth_female=1 because fertility is for female only</span></span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>demokin_svk1980_caswell2020 <span class="ot">&lt;-</span> </span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>  <span class="fu">kin_multi_stage</span>(</span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>    <span class="at">U =</span> svk_Uxs,</span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a>    <span class="at">f =</span> svk_fxs,</span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a>    <span class="at">D =</span> svk_pxs,</span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a>    <span class="at">H =</span> svk_Hxs, </span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a>    <span class="at">birth_female=</span><span class="dv">1</span>,</span>
<span id="cb58-9"><a href="#cb58-9" tabindex="-1"></a>    <span class="at">parity =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="age-and-parity-distribution" class="section level4">
<h4>2. Age and parity distribution of kin</h4>
<p>Note that the function ask for risks already in a certain matrix
format. As an example, consider the age-parity distribution of aunts,
when Focal is 20 and 60 yo (this is equivalent to Figure 4 in Caswell
<span class="citation">(2021)</span>).</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>demokin_svk1980_caswell2020 <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>  <span class="fu">filter</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;oa&quot;</span>,<span class="st">&quot;ya&quot;</span>), age_focal <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">60</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parity =</span> <span class="fu">as.integer</span>(stage_kin)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>         <span class="at">parity =</span> <span class="fu">case_when</span>(parity <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;5+&quot;</span>, T <span class="sc">~</span> <span class="fu">as.character</span>(parity))</span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a>  <span class="fu">group_by</span>(age_focal, age_kin, parity) <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span> <span class="fu">sum</span>(living)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-8"><a href="#cb59-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>age_kin, <span class="at">y =</span> count, <span class="at">fill=</span>parity), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> age_focal), <span class="at">col=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Number of aunts&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-12"><a href="#cb59-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb59-13"><a href="#cb59-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>age_focal, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="kin-by-parity" class="section level4">
<h4>3. Kin counts by parity</h4>
<p>We can also see the portion of living daughters and mothers at
different parity stages over Focal’s life-course (this is equivalent to
Figure 9 and 10 in Caswell <span class="citation">(2021)</span>).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>demokin_svk1980_caswell2020 <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>  <span class="fu">filter</span>(kin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>,<span class="st">&quot;m&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parity =</span> <span class="fu">as.integer</span>(stage_kin)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>         <span class="at">parity =</span> <span class="fu">case_when</span>(parity <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;5+&quot;</span>, T <span class="sc">~</span> <span class="fu">as.character</span>(parity))) <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>  <span class="fu">group_by</span>(age_focal, kin, parity) <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span> <span class="fu">sum</span>(living)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a>  DemoKin<span class="sc">::</span><span class="fu">rename_kin</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>age_focal, <span class="at">y =</span> count, <span class="at">fill=</span>parity), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Kin count&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb60-12"><a href="#cb60-12" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>kin, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>This function <code>kin_multi_stage</code> can be generalized to any
kind of state (be sure to set parameter <code>parity = FALSE</code>, de
default).</p>
</div>
</div>
<div id="adding-sex-and-time-two-sex-time-varying-multi-state-models"
class="section level3 tabset">
<h3 class="tabset">Adding sex and time: Two-sex Time-varying Multi-state
models</h3>
<div class="custom-toc">
<h4>
Contents
</h4>
<ul>
<li>
<a href="#parity-as-stage">1. Parity as the stage</a>
</li>
<li>
<a href="#education-as-stage">2. Education as the stage</a>
</li>
</ul>
</div>
<p>Since Caswell’s <span class="citation">(Caswell 2019)</span> one-sex
time-invariant age-structured matrix model of kinship, the framework has
expanded to incorporate time-varying vital rates <span
class="citation">(2021)</span>, two-sex of kin and focal <span
class="citation">(2022)</span> and multi-state kin populations <span
class="citation">(2020)</span>.<br />
Here, we provide an R
function<code>kin_multi_stage_time_variant_2sex</code>, which combines
the three aforementioned models and provide a two-sex time-varying
multi-state model.</p>
<p>This function computes stage-specific kinship networks across both
sexes for an average member of a population (focal) under time-varying
demographic rates. It estimates the number, age, sex, and stage
distribution of Focal’s relatives, for each age of Focal’s life, and as
a function of the year in which Focal is born.</p>
<p>To illustrate it, we show two examples, where parity and education
are used to stratify different stages. #### Parity as the stage
{#parity-as-stage}</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="co"># library(DemoKin)</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>) <span class="co"># hide if we don&#39;t want to see summarise output (but also #lose #progress bar)</span></span></code></pre></div>
<div id="model-input" class="section level5">
<h5>1. Model input</h5>
<p>In this example we use parity as an example stage. UK data ranging
from 1965 - 2022 is sourced from the <a
href="https://www.mortality.org/">Human Mortality Database</a> and <a
href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/conceptionandfertilityrates/adhocs/1887fertilityratesbyparityenglandandwales1934to2022/">Office
for National Statistics</a>. Some simplifying assumptions we make due to
data availability are as follows:</p>
<ol style="list-style-type: lower-roman">
<li>Fertility rates vary with time, are distinct among parity class, but
the same over sexes (the so-called ``androgynous approximation’’).</li>
<li>Mortality rates vary with time, are distinct across sex, but are the
same over parity classes (no parity-specific mortality)</li>
<li>The age-specific probabilities of parity-progression vary with time,
but are the same over sex (androgynous approximation again)</li>
</ol>
<p>In order to implement the model, the function
<code>kin_multi_stage_time_variant_2sex</code> expects the following 7
inputs of vital rates, fed in as lists:</p>
<ol style="list-style-type: decimal">
<li><p><code>U_list_females</code> A list of female age-and-parity
specific survival probabilities over the timescale (in matrix forms).
This input list has length = the timescale, and each entry represents
the rates of a specific period in matrix form: stage columns, age
rows.</p></li>
<li><p><code>U_list_males</code> A list of male age-and-parity specific
survival probabilities over the timescale (in matrix forms). This input
list has length = the timescale, and each entry represents the rates of
a specific period in matrix form: stage columns, age rows.</p></li>
<li><p><code>F_list_females</code> A list of female age-and-parity
specific fertility rates over the timescale (in matrix forms). This
input list has length = the timescale, and each entry represents the
rates of a specific period in matrix form: stage columns, age
rows.</p></li>
<li><p><code>F_list_males</code> A list of male age-and-parity specific
fertility rates over the timescale (in matrix forms). This input list
has length = the timescale, and each entry represents the rates of a
specific period in matrix form: stage columns, age rows.</p></li>
<li><p><code>T_list_females</code> A list of lists of female
age-specific probabilities of moving up parity over the timescale (in
matrix forms). The outer list has length = the timescale. The inner list
has length = number of ages. Each outer list entry is comprised of a
list of matrices (stage*stage dimensional), each matrix describes
age-specific probabilities of moving stage. Thus for each year, we have
a list of age-specific probabilities of moving from one stage to the
next.</p></li>
<li><p>Same as 5) but for males</p></li>
<li><p><code>H_list</code> A list of length = timescale, in which each
element is a matrix which assigns the offspring of individuals in some
stage to the appropriate age class (age in rows and states in
columns)</p></li>
</ol>
<p>To avoid the need for tedious calculations to put data into such
format in this vignette, these lists are constructed in another file and
simply imported below. The code below reads in the above function input
lists.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>F_mat_fem <span class="ot">&lt;-</span> Female_parity_fert_list_UK</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>F_mat_male <span class="ot">&lt;-</span> Female_parity_fert_list_UK</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>T_mat_fem <span class="ot">&lt;-</span> Parity_transfers_by_age_list_UK</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>T_mat_male <span class="ot">&lt;-</span> Parity_transfers_by_age_list_UK</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>U_mat_fem <span class="ot">&lt;-</span> Female_parity_mortality_list_UK</span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>U_mat_male <span class="ot">&lt;-</span> Male_parity_mortality_list_UK</span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a>H_mat <span class="ot">&lt;-</span> Redistribution_by_parity_list_UK</span></code></pre></div>
<p>Recap: above are lists of period-specific demographic rates, in
particular comprising:</p>
<p>U_mat_fem: list of age by stage matrices, entries give female
probability of survival. List starting 1965 ending 2022.</p>
<p>U_mat_male: list of age by stage matrices, entries give female
probability of survival. List starting 1965 ending 2022.</p>
<p>F_mat_fem: list of age by stage matrices, entries give female fert,
List starting 1965 ending 2022.</p>
<p>F_mat_male == F_mat_fem.</p>
<p>T_mat_fem: list of lists of matrices: Each outer list entry is a list
of matrices where each matrix gives age-specific probabilities a female
moves up parity (inner list has length of number of age-classes). Outer
list starting 1965 ending 2022</p>
<p>T_mat_male == T_mat_fem.</p>
<p>H_mat: list of matrices which redistributes newborns to age-class 1
and parity 0. No time-variation.</p>
</div>
<div id="run-the-model" class="section level5">
<h5>2. Run the model</h5>
<p>We feed the above inputs into the matrix model, along with other
arguments:</p>
<ul>
<li>UK sex ratio –&gt; <code>birth_female</code> = 0.49</li>
<li>We are considering parity –&gt; <code>parity</code> = TRUE</li>
<li>We want some of Focal’s kin network –&gt; <code>output_kin</code> =
c(“d”, “oa”, “ys”, “os”)</li>
<li>Accumulated kin in this example –&gt; <code>summary_kin</code> =
TRUE</li>
<li>Focal is female –&gt; <code>sex_Focal</code> = “Female”</li>
<li>Focal born into parity 0 –&gt; <code>initial_stage_Focal</code> =
1</li>
<li>timescale as ouptut – &gt; <code>output_years</code> = c(1965, 1975,
1985, 1995, 2005)</li>
</ul>
<p>Accumulated kin are outputted by the argument
<code>summary_kin</code> = TRUE. In such cases, for each age of Focal,
we sum over all possible ages of kin yielding the marginal stage
distribution of kin.</p>
<p>The first sets of time-varying vital rates in our input lists are
e.g., U_mat_fem[[1]] (corresponding to mortality in 1965), the 41-st
entry is U_mat_fem[[(1+40)]] (mortality in 2005). We require consistency
between the length of the list of vital rates and the timescale:
U_mat_fem[[1:(1+40)]] = in length = seq(1965,2005). Therefore we use the
input lists of demographic rates</p>
<p><code>U_list_females</code> = U_mat_fem[1:(1+no_years)] which runs
from U_mat_fem[[1]] = 1965 set of rates, up to U_mat_fem[[41]] = 2005
set of rates, and so on…</p>
<blockquote>
<p>this run takes some time (round 10 min) so we don´t include the
output in the vignette. Please try it!</p>
</blockquote>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="co"># Run kinship model for a female Focal over a timescale of no_years (we use 40 here)</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>no_years <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a><span class="co"># and we start projecting kin in 1965</span></span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a><span class="co"># We decide here to count accumulated kin by age of Focal, and not distributions of kin</span></span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a>kin_out_1965_2005 <span class="ot">&lt;-</span></span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a>  <span class="fu">kin_multi_stage_time_variant_2sex</span>(<span class="at">U_list_females =</span> U_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a>                                    <span class="at">U_list_males =</span> U_mat_male[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-8"><a href="#cb63-8" tabindex="-1"></a>                                    <span class="at">F_list_females =</span> F_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-9"><a href="#cb63-9" tabindex="-1"></a>                                    <span class="at">F_list_males =</span> F_mat_male[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-10"><a href="#cb63-10" tabindex="-1"></a>                                    <span class="at">T_list_females =</span> T_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-11"><a href="#cb63-11" tabindex="-1"></a>                                    <span class="at">T_list_males =</span> T_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-12"><a href="#cb63-12" tabindex="-1"></a>                                    <span class="at">H_list =</span> H_mat[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb63-13"><a href="#cb63-13" tabindex="-1"></a>                                    <span class="at">birth_female =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.51</span>, <span class="do">## Sex ratio -- UK value</span></span>
<span id="cb63-14"><a href="#cb63-14" tabindex="-1"></a>                                    <span class="at">parity =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-15"><a href="#cb63-15" tabindex="-1"></a>                                    <span class="at">output_kin =</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;oa&quot;</span>, <span class="st">&quot;ys&quot;</span>, <span class="st">&quot;os&quot;</span>),</span>
<span id="cb63-16"><a href="#cb63-16" tabindex="-1"></a>                                    <span class="at">summary_kin =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-17"><a href="#cb63-17" tabindex="-1"></a>                                    <span class="at">sex_Focal =</span> <span class="st">&quot;Female&quot;</span>, <span class="do">##  define Focal&#39;s sex at birth</span></span>
<span id="cb63-18"><a href="#cb63-18" tabindex="-1"></a>                                    <span class="at">initial_stage_Focal =</span> <span class="dv">1</span>, <span class="do">## Define Focal&#39;s stage at birth</span></span>
<span id="cb63-19"><a href="#cb63-19" tabindex="-1"></a>                                    <span class="at">output_years =</span> <span class="fu">c</span>(<span class="dv">1965</span>, <span class="dv">1975</span>, <span class="dv">1985</span>, <span class="dv">1995</span>, <span class="dv">2005</span>) <span class="do">## the sequence of years we run the function over</span></span>
<span id="cb63-20"><a href="#cb63-20" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 1953.592 sec elapsed</code></pre>
</div>
<div id="kin-counts" class="section level5">
<h5>3. Kin counts</h5>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="fu">head</span>(kin_out_1965_2005<span class="sc">$</span>kin_summary)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   age_focal stage_kin count sex_kin  year group cohort cohort_factor
##       &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt;        
## 1         0 1             0 Female   1965 d       1965 1965         
## 2         0 1             0 Male     1965 d       1965 1965         
## 3         0 2             0 Female   1965 d       1965 1965         
## 4         0 2             0 Male     1965 d       1965 1965         
## 5         0 3             0 Female   1965 d       1965 1965         
## 6         0 3             0 Male     1965 d       1965 1965</code></pre>
<p>Notice the structure of the output data. We have columns
<code>age_focal</code> and <code>kin_stage</code> because we sum over
all ages of kin, and produce the marginal stage distribution given age
of Focal. We have a column corresponding to sex of kin
<code>sex_kin</code>, a column showing which <code>year</code> we are
considering, and a column headed <code>group</code> which selects the
kin type. Finally, we have columns showing Focal’s cohort of birth
<code>cohort</code> (e.g., year - age of Focal), and an as.factor()
equivalent.</p>
<div id="from-a-period-perspective" class="section level6">
<h6>3.1. From a period perspective</h6>
<p>Let’s suppose that we really want to understand the age*parity
distributions of the accumulated number of aunts and uncles older than
Focal’s mother and father, for each age of Focal, over years 1965, 1975,
1985, 1995, 2005. Some people will do….</p>
<p>We restrict Focal’s kinship network to aunts and uncles older than
Focal’s mother by <code>group</code> == “oa”. We visualise the marginal
parity distributions of kin: <code>stage_kin</code>, for each age of
Focal <code>age_focal</code>, using different colour schemes. Implicit
in the below plot is that we really plot Focal’s born into different
<code>cohort</code> – i.e., in the 2005 panel we show a 50 year old
Focal was born in 1955, while a 40 year old Focal was born in 1965.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;oa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb67-7"><a href="#cb67-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">&quot;Older aunts and uncles&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-47-1.png" width="768" style="display: block; margin: auto;" />
We could also consider any other kin in Focal’s network, for instance,
offspring using <code>group</code> == “d”</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;d&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb68-9"><a href="#cb68-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">&quot;Offspring&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="from-a-cohort-perspective" class="section level6">
<h6>3.2. From a cohort perspective</h6>
<p>Since we only ran the model for 40 years (between 1965-2005), there
is very little scope to view kinship as cohort-specific. We can however
compare cohorts for 40-year segments of Focal’s life. Below, following
from the above example, we once again consider offspring and only show
Focals born of <code>cohort</code> 1910, 1925, or 1965:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;d&quot;</span>, cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1910</span>,<span class="dv">1925</span>,<span class="dv">1965</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> cohort)  <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">&quot;Offspring&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" width="768" style="display: block; margin: auto;" />
The LHS plot (1910 cohort) should be interpreted as follows: if Focal is
born in 1910, between 1965-2005 he/she will be 55-95 years old. Focal
will have already accumulated its maximal number of offspring, and their
overall number will now be dropping as mortality risk begins. The
offspring of Focal will be approximately 20-35, and began if not
completed reproduction/parity progression.</p>
<p>The middle plot (1925 cohort) shows Focal between ages 40 and 80.
Again, Focal will have completed reproduction and can only lose
offspring as he/she ages. However, Offspring at Focal of age 40 will be
around 10-20 and still have high probability of being in parity 0.
Whereas, Focal at age of 80 will have offspring aged around 50, who in
turn will have completed reproduction as demonstrated by a well mixed
parity-distribution at this age of Focal.</p>
<p>the RHS plot (1965 cohort) simply reflects the fact that Focal will
not start reproduction until around 15 years old.</p>
</div>
</div>
<div id="age-distribution-of-kin" class="section level5">
<h5>4. Age distribution of kin</h5>
<p>To obtain distributions of kin as output, we simply use the
<code>kin_full</code> data.frame.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">head</span>(kin_out_1965_2005<span class="sc">$</span>kin_full)</span></code></pre></div>
<pre><code>##   age_focal age_kin stage_kin count sex_kin year group cohort cohort_factor
## 1         0       0         1     0  Female 1965     d   1965          1965
## 2         0       0         2     0  Female 1965     d   1965          1965
## 3         0       0         3     0  Female 1965     d   1965          1965
## 4         0       0         4     0  Female 1965     d   1965          1965
## 5         0       0         5     0  Female 1965     d   1965          1965
## 6         0       0         6     0  Female 1965     d   1965          1965</code></pre>
<p>Notice the additional column <code>age_kin</code>. Rather than
grouping kin by stage and summing over all ages, the output here (in
data frame form) gives an expected number of kin for each age*stage
combination, for each age of Focal.</p>
<p>Lets’s consider Focal is aged 50 <code>age_focal</code> == 50, and
examine kin younger siblings; <code>group</code> == “ys”. Restricting
ourselves to the years 1965, 1975, 1985, 1995, 2005, we can plot the
expected age*stage distribution of these kin over the considered
periods, as shown below:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;ys&quot;</span>,</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>                age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">&quot;Younger siblings&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&quot;Focal 50&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-51-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Notice the discontinuity along the x-abscissa at 50. This reflects
the fact that Focal’s younger siblings cannot are of age &lt;50.
Contrastingly, when we look at the age*stage distribution of older
siblings, we observe another discontinuity which bounds kin to be of age
&gt;50, as plotted below:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;os&quot;</span>,</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>                age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb73-10"><a href="#cb73-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">&quot;Older siblings&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-11"><a href="#cb73-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&quot;Focal 50&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-52-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>With a simple bit of playing with the output data frame, we can plot
the age*stage distribution of the combined siblings of Focal</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>((group <span class="sc">==</span> <span class="st">&quot;ys&quot;</span> <span class="sc">|</span> group <span class="sc">==</span> <span class="st">&quot;os&quot;</span>),</span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>                age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> count) <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">count =</span> <span class="st">`</span><span class="at">ys</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">os</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">&quot;All siblings&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-13"><a href="#cb74-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&quot;Focal 50&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-53-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="education-as-stage" class="section level4">
<h4>Education as the stage</h4>
<div id="data-input" class="section level5">
<h5>1. Data Input</h5>
<p>In this example we use education as an example stage. Singaporean
data ranging from 2020 - 2090 is sourced from the <a
href="https://www.wittgensteincentre.org/en/index.htm">Wittgenstein
Center</a>. The data is aggregated into 5-year age group and 5-year time
interval.</p>
<p>In order to implement the model, the function
<code>kin_multi_stage_time_variant_2sex</code> expects the following 7
inputs of vital rates, fed in as lists:</p>
<ol style="list-style-type: decimal">
<li><p><code>U_list_females</code> A list of female age-and-education
specific survival probabilities over the timescale (in matrix forms).
This input list has length = the timescale, and each entry represents
the rates of a specific period in matrix form: stage columns, age
rows.</p></li>
<li><p><code>U_list_males</code> A list in the same format as
<code>U_list_females</code>, but for males.</p></li>
<li><p><code>F_list_females</code> A list of female age-and-education
specific fertility rates over the timescale (in matrix forms). This
input list has length = the timescale, and each entry represents the
rates of a specific period in matrix form: stage columns, age
rows.</p></li>
<li><p><code>F_list_males</code> A list in the same format as
<code>F_list_females</code>, but for males.</p></li>
<li><p><code>T_list_females</code> A list of lists of female
age-specific probabilities of moving up education over the timescale (in
matrix forms). The outer list has length = the timescale. The inner list
has length = number of ages. Each outer list entry is comprised of a
list of matrices (stage*stage dimensional), each matrix describes
age-specific probabilities of moving stage. Thus for each year, we have
a list of age-specific probabilities of moving from one stage to the
next.</p></li>
<li><p><code>T_list_males</code> A list in the same format as
<code>T_list_females</code>, but for males.</p></li>
<li><p><code>H_list</code> A list of length = timescale, in which each
element is a matrix which assigns the offspring of individuals in some
stage to the appropriate age class (age in rows and states in columns).
This list of matrices applies to both male and female
offspring.</p></li>
</ol>
<p>We pre-processed the data for this workshop:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/singapore_edu.rdata&quot;</span>)</span></code></pre></div>
</div>
<div id="run-multistate-kinship-model" class="section level5">
<h5>2. Run multistate kinship model</h5>
<p>We feed the above inputs into the matrix model, along with other
arguments:</p>
<blockquote>
<p>this run takes some time (ca. 5 min)</p>
</blockquote>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="co"># Run kinship model for a female Focal over a timescale of no_years</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>time_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2020</span>,<span class="dv">2090</span>,<span class="dv">5</span>)</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>no_years <span class="ot">&lt;-</span> <span class="fu">length</span>(time_range)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a><span class="co"># For 5-y age and year intervals</span></span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a>output_year_select <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, no_years<span class="sc">+</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a><span class="co"># since we use 5-year time frame, we are projecting from 2020 to 2020+5*14 = 2090</span></span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a><span class="co"># We decide here to count accumulated kin by age of Focal, and not distributions of kin</span></span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a>kin_out_2020_2090 <span class="ot">&lt;-</span></span>
<span id="cb76-10"><a href="#cb76-10" tabindex="-1"></a>  <span class="fu">kin_multi_stage_time_variant_2sex</span>(<span class="at">U_list_females =</span> U_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-11"><a href="#cb76-11" tabindex="-1"></a>                                    <span class="at">U_list_males =</span> U_mat_male_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-12"><a href="#cb76-12" tabindex="-1"></a>                                    <span class="at">F_list_females =</span> F_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-13"><a href="#cb76-13" tabindex="-1"></a>                                    <span class="at">F_list_males =</span> F_mat_male_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-14"><a href="#cb76-14" tabindex="-1"></a>                                    <span class="at">T_list_females =</span> T_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-15"><a href="#cb76-15" tabindex="-1"></a>                                    <span class="at">T_list_males =</span> T_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-16"><a href="#cb76-16" tabindex="-1"></a>                                    <span class="at">H_list =</span> H_mat_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],</span>
<span id="cb76-17"><a href="#cb76-17" tabindex="-1"></a>                                    <span class="at">birth_female =</span> <span class="dv">1</span><span class="sc">/</span>(<span class="fl">1.06</span><span class="sc">+</span><span class="dv">1</span>), <span class="do">## Sex ratio at birth -- Singapore value (1.06)</span></span>
<span id="cb76-18"><a href="#cb76-18" tabindex="-1"></a>                                    <span class="at">parity =</span> <span class="cn">FALSE</span>,</span>
<span id="cb76-19"><a href="#cb76-19" tabindex="-1"></a>                                    <span class="at">summary_kin =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-20"><a href="#cb76-20" tabindex="-1"></a>                                    <span class="at">sex_Focal =</span> <span class="st">&quot;Female&quot;</span>, <span class="do">##  define Focal&#39;s sex at birth</span></span>
<span id="cb76-21"><a href="#cb76-21" tabindex="-1"></a>                                    <span class="at">initial_stage_Focal =</span> <span class="dv">1</span>, <span class="do">## Define Focal&#39;s stage at birth</span></span>
<span id="cb76-22"><a href="#cb76-22" tabindex="-1"></a>                                    <span class="at">output_years =</span> output_year_select <span class="co"># it seems tricky to set up output years when the time interval is not 1</span></span>
<span id="cb76-23"><a href="#cb76-23" tabindex="-1"></a>                                    <span class="co"># now I select every 10 year for output</span></span>
<span id="cb76-24"><a href="#cb76-24" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 130.27 sec elapsed</code></pre>
<p>Now we have to recode year and age related variables to show the
correct years and educational labels:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="co"># also need to change the age_focal and year variables accordingly</span></span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="ot">&lt;-</span> </span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a>  kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> (year<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">5</span><span class="sc">+</span><span class="fu">min</span>(time_range),</span>
<span id="cb78-5"><a href="#cb78-5" tabindex="-1"></a>         <span class="at">age_focal =</span> age_focal<span class="sc">*</span><span class="dv">5</span>,</span>
<span id="cb78-6"><a href="#cb78-6" tabindex="-1"></a>         <span class="at">cohort =</span> year <span class="sc">-</span> age_focal,</span>
<span id="cb78-7"><a href="#cb78-7" tabindex="-1"></a>         <span class="at">stage_kin =</span> <span class="fu">factor</span>(stage_kin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb78-8"><a href="#cb78-8" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb78-9"><a href="#cb78-9" tabindex="-1"></a>                         <span class="st">&quot;no education&quot;</span>,</span>
<span id="cb78-10"><a href="#cb78-10" tabindex="-1"></a>                         <span class="st">&quot;incomplete primary&quot;</span>,</span>
<span id="cb78-11"><a href="#cb78-11" tabindex="-1"></a>                         <span class="st">&quot;primary&quot;</span>,</span>
<span id="cb78-12"><a href="#cb78-12" tabindex="-1"></a>                         <span class="st">&quot;lower secondary&quot;</span>,</span>
<span id="cb78-13"><a href="#cb78-13" tabindex="-1"></a>                         <span class="st">&quot;upper secondary&quot;</span>,</span>
<span id="cb78-14"><a href="#cb78-14" tabindex="-1"></a>                         <span class="st">&quot;post-secondary&quot;</span></span>
<span id="cb78-15"><a href="#cb78-15" tabindex="-1"></a>                       )))</span>
<span id="cb78-16"><a href="#cb78-16" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_full <span class="ot">&lt;-</span> kin_out_2020_2090<span class="sc">$</span>kin_full<span class="sc">%&gt;%</span></span>
<span id="cb78-18"><a href="#cb78-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> (year<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">5</span><span class="sc">+</span><span class="fu">min</span>(time_range),</span>
<span id="cb78-19"><a href="#cb78-19" tabindex="-1"></a>         <span class="at">age_focal =</span> age_focal<span class="sc">*</span><span class="dv">5</span>,</span>
<span id="cb78-20"><a href="#cb78-20" tabindex="-1"></a>         <span class="at">age_kin =</span> age_kin<span class="sc">*</span><span class="dv">5</span>,</span>
<span id="cb78-21"><a href="#cb78-21" tabindex="-1"></a>         <span class="at">cohort =</span> year <span class="sc">-</span> age_focal,</span>
<span id="cb78-22"><a href="#cb78-22" tabindex="-1"></a>         <span class="at">stage_kin =</span> <span class="fu">factor</span>(stage_kin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb78-23"><a href="#cb78-23" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb78-24"><a href="#cb78-24" tabindex="-1"></a>                         <span class="st">&quot;no education&quot;</span>,</span>
<span id="cb78-25"><a href="#cb78-25" tabindex="-1"></a>                         <span class="st">&quot;incomplete primary&quot;</span>,</span>
<span id="cb78-26"><a href="#cb78-26" tabindex="-1"></a>                         <span class="st">&quot;primary&quot;</span>,</span>
<span id="cb78-27"><a href="#cb78-27" tabindex="-1"></a>                         <span class="st">&quot;lower secondary&quot;</span>,</span>
<span id="cb78-28"><a href="#cb78-28" tabindex="-1"></a>                         <span class="st">&quot;upper secondary&quot;</span>,</span>
<span id="cb78-29"><a href="#cb78-29" tabindex="-1"></a>                         <span class="st">&quot;post-secondary&quot;</span></span>
<span id="cb78-30"><a href="#cb78-30" tabindex="-1"></a>                       )))</span></code></pre></div>
</div>
<div id="number-of-living-kin-by-education-of-kin"
class="section level5">
<h5>3. Number of living kin by education of kin</h5>
<p>Notice the structure of the output data <code>kin_summary</code>. We
have columns <code>age_focal</code> and <code>kin_stage</code> because
we sum over all ages of kin, and produce the marginal stage distribution
given age of Focal. We have a column corresponding to sex of kin
<code>sex_kin</code>, a column showing which <code>year</code> we are
considering, and a column headed <code>group</code> which selects the
kin type. Finally, we have columns showing Focal’s cohort of birth
<code>cohort</code> (e.g., year - age of Focal).</p>
<p>Let’s take a look at <code>kin_summary</code> by selecting 10 rows,
from row 1000 to row 1010.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary[<span class="dv">1000</span><span class="sc">:</span><span class="dv">1010</span>, ]</span></code></pre></div>
<pre><code>## # A tibble: 11 × 8
##    age_focal stage_kin             count sex_kin  year group cohort cohort_factor
##        &lt;dbl&gt; &lt;fct&gt;                 &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt;        
##  1       100 incomplete primary 0.172    Male     2020 ggd     1920 -19          
##  2       100 primary            0.105    Female   2020 ggd     1920 -19          
##  3       100 primary            0.111    Male     2020 ggd     1920 -19          
##  4       100 lower secondary    0.0371   Female   2020 ggd     1920 -19          
##  5       100 lower secondary    0.0393   Male     2020 ggd     1920 -19          
##  6       100 upper secondary    0.0114   Female   2020 ggd     1920 -19          
##  7       100 upper secondary    0.0120   Male     2020 ggd     1920 -19          
##  8       100 post-secondary     0.000114 Female   2020 ggd     1920 -19          
##  9       100 post-secondary     0.000121 Male     2020 ggd     1920 -19          
## 10         0 no education       0        Female   2020 m       2020 1            
## 11         0 no education       0        Male     2020 m       2020 1</code></pre>
<div id="cohort-approach" class="section level6">
<h6>3.1. Cohort approach</h6>
<p>We start by showing the number of living kin for an average woman
born in 2020 in Singapore by level of educational attainment of her
kin:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a>  <span class="co"># Multistate models also include an (educational) state for the Focal individual</span></span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a>  <span class="co"># which is not of interest here</span></span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">!=</span> <span class="st">&quot;Focal&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a>  <span class="fu">filter</span>(cohort <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-6"><a href="#cb81-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb81-7"><a href="#cb81-7" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-8"><a href="#cb81-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(stage_kin, age_focal)) <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">fill=</span>stage_kin)) <span class="sc">+</span></span>
<span id="cb81-10"><a href="#cb81-10" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb81-11"><a href="#cb81-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of living kin&quot;</span>,</span>
<span id="cb81-12"><a href="#cb81-12" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age of a woman born in 2020&quot;</span>) <span class="sc">+</span></span>
<span id="cb81-13"><a href="#cb81-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-14"><a href="#cb81-14" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-58-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Show the same values, but separately for selected kin:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>  <span class="fu">filter</span>(cohort <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-6"><a href="#cb82-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(kin_label, stage_kin, age_focal)) <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">fill=</span>stage_kin)) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of living kin&quot;</span>,</span>
<span id="cb82-10"><a href="#cb82-10" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age of a woman born in 2020&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-11"><a href="#cb82-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb82-12"><a href="#cb82-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb82-13"><a href="#cb82-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-59-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Next, we see the age distribution of kin (by education of kin) for a
60 yo woman born in the year 2020:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a>    group <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>)</span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a>    ,  age_focal <span class="sc">==</span> <span class="dv">60</span></span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a>    , cohort <span class="sc">==</span> <span class="dv">2020</span></span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-11"><a href="#cb83-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb83-12"><a href="#cb83-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x  =</span><span class="st">&quot;Age of kin for a 65 yo woman born in 2020&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-13"><a href="#cb83-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(. <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb83-14"><a href="#cb83-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb83-15"><a href="#cb83-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb83-16"><a href="#cb83-16" tabindex="-1"></a>    <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb83-17"><a href="#cb83-17" tabindex="-1"></a>    , <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb83-18"><a href="#cb83-18" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-60-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="period-approach" class="section level6">
<h6>3.2. Period approach</h6>
<p>Let’s see the expected number of living children and grandchildren
for a 60 yo woman over time by the level of educational attainment of
the children and grandchildren:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>    group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>)</span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a>    , age_focal <span class="sc">==</span> <span class="dv">60</span></span>
<span id="cb84-5"><a href="#cb84-5" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(stage_kin, kin_label, year)) <span class="sc">%&gt;%</span></span>
<span id="cb84-9"><a href="#cb84-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> count, <span class="at">fill=</span>stage_kin)) <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of descendants a for woman aged 60&quot;</span>,</span>
<span id="cb84-12"><a href="#cb84-12" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-13"><a href="#cb84-13" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-61-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>And, finally, the level of education of the parents and grandparents
of a newborn woman over time:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>    group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>)</span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>    , age_focal <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="#cb85-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="#cb85-7" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="#cb85-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(stage_kin, kin_label, year)) <span class="sc">%&gt;%</span></span>
<span id="cb85-9"><a href="#cb85-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> count, <span class="at">fill=</span>stage_kin)) <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Expected number of descendants a for newborn woman (aged 0)&quot;</span>,</span>
<span id="cb85-12"><a href="#cb85-12" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb85-15"><a href="#cb85-15" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-62-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>We note that there are following simplifying assumptions due to data
limitations:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary over time and by education level but are
identical for both sexes (the androgynous approximation).</li>
<li>Age-specific education transition probabilities vary over time but
not by sex (also an androgynous approximation).</li>
<li>Since no transition data exist beyond age 10, we assume that at ages
0-4, individuals transition from no education to incomplete primary in
the next 5-year interval, and at ages 5-9, they transition from
incomplete primary to primary (based on Singapore’s Compulsory Education
Act).</li>
<li>Demographic rates remain stable (time-invariant) before 2020, the
earliest observed data point.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<!-- Add custom CSS for TOC styling -->
<style type="text/css">
.custom-toc {
  background-color: #f8f8f8;
  border: 1px solid #ddd;
  border-radius: 5px;
  padding: 15px;
  margin-bottom: 20px;
}

.custom-toc h4 {
  margin-top: 0;
  margin-bottom: 10px;
  border-bottom: 1px solid #ddd;
  padding-bottom: 5px;
}

.custom-toc ul {
  list-style-type: none;
  padding-left: 5px;
}

.custom-toc li {
  margin-bottom: 5px;
}

.custom-toc a {
  text-decoration: none;
  color: #337ab7;
}

.custom-toc a:hover {
  text-decoration: underline;
}
</style>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-caswell_formal_2019" class="csl-entry">
Caswell, Hal. 2019. <span>“The Formal Demography of Kinship:
<span>A</span> Matrix Formulation.”</span> <em>Demographic Research</em>
41 (September): 679–712. <a
href="https://doi.org/10.4054/DemRes.2019.41.24">https://doi.org/10.4054/DemRes.2019.41.24</a>.
</div>
<div id="ref-caswell_formal_2020" class="csl-entry">
———. 2020. <span>“The Formal Demography of Kinship <span>II</span>:
<span>Multistate</span> Models, Parity, and Sibship.”</span>
<em>Demographic Research</em> 42 (June): 1097–1146. <a
href="https://doi.org/10.4054/DemRes.2020.42.38">https://doi.org/10.4054/DemRes.2020.42.38</a>.
</div>
<div id="ref-caswell_formal_2022" class="csl-entry">
———. 2022. <span>“The Formal Demography of Kinship <span>IV</span>:
<span>Two</span>-Sex Models and Their Approximations.”</span>
<em>Demographic Research</em> 47 (September): 359–96. <a
href="https://doi.org/10.4054/DemRes.2022.47.13">https://doi.org/10.4054/DemRes.2022.47.13</a>.
</div>
<div id="ref-Caswell2023" class="csl-entry">
Caswell, Hal, Rachel Margolis, and Ashton Verdery. 2023. <span>“<span
class="nocase">The formal demography of kinship V: Kin loss,
bereavement, and causes of death</span>.”</span> <em>Demographic
Research</em> 49 (December): 1163–1200. <a
href="https://www.demographic-research.org/articles/volume/49/41">https://www.demographic-research.org/articles/volume/49/41</a>.
</div>
<div id="ref-caswell_formal_2021" class="csl-entry">
Caswell, Hal, and Xi Song. 2021. <span>“The Formal Demography of Kinship
<span>III</span>: <span>Kinship</span> Dynamics with Time-Varying
Demographic Rates.”</span> <em>Demographic Research</em> 45 (August):
517–46. <a
href="https://doi.org/10.4054/DemRes.2021.45.16">https://doi.org/10.4054/DemRes.2021.45.16</a>.
</div>
<div id="ref-Keyfitz2005" class="csl-entry">
Keyfitz, Nathan, Hal Caswell, et al. 2005. <em>Applied Mathematical
Demography</em>. Vol. 47. Springer.
</div>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
